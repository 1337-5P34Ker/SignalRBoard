<!DOCTYPE html>
<html>
<head>
    <title>SignalR Board</title>
    <!-- Style references -->
    <link rel="stylesheet" href="Content/bootstrap.min.css" />
    <link rel="stylesheet" href="Content/bootstrap-theme.min.css" />
    <link rel="stylesheet" href="Content/font-awesome.min.css" />

    <!--Script references. -->
    <!--Reference the jQuery library. -->
    <script src="Scripts/jquery-2.2.3.min.js"></script>
    <!--Reference the Bootstrap library. -->
    <script src="Scripts/bootstrap.min.js"></script>
    <!--Reference the SignalR library. -->
    <script src="/Scripts/jquery.signalR-2.2.0.min.js"></script>
    <!--Reference the autogenerated SignalR hub script. -->
    <script src="/signalr/hubs"></script>
</head>
<body>

    <!-- Fixed navbar -->
    <nav class="navbar navbar-inverse navbar-fixed-top">
        <div class="container">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="#">SignalR Board for Dev 1</a>
            </div>
        </div>
    </nav>


    <div class="container" style="margin-top: 80px">

        <div class="row">
            <div class="col-md-4">
                <div class="list-group" id="fb9344df-0d30-4183-bd15-d3c2e4afe978">


                </div>
            </div>
            <div class="col-md-4">
                <div class="list-group" id="fb9344df-0d30-4183-bd15-d3c2e4afe9aa">

                </div>
            </div>
            <div class="col-md-4">
                <div class="list-group" id="fb9344df-0d30-4183-bd15-d3c2e4afe9bb">

                </div>
            </div>
        </div>
        <div class="row" id="form">
            <div class="col-md-4">
                <div class="form-group">
                    <label for="title">Titel:</label>
                    <input type="text" id="title" class="form-control" placeholder="Titel" />
                    <input type="hidden" id="cardId" />
                </div>
                <div class="form-group">
                    <label for="description">Beschreibung:</label>
                    <textarea id="description" class="form-control" placeholder="Beschreibung" style="height: 75px"></textarea>
                </div>
                <div class="btn-group" role="group">
                    <input type="button" id="btnSave" value="Add" class="btn btn-default" />
                    <input type="button" id="btnUpdate" value="Update" class="btn btn-default" />
                    <input type="button" id="btnDelete" value="Delete" class="btn btn-default" />
                </div>
                <div class="btn-group" role="group" style="margin-top:30px">
                    <input type="button" id="btnMoveUp" value="Up" class="btn btn-default" />
                    <input type="button" id="btnMoveDown" value="Down" class="btn btn-default" />
                    <input type="button" id="btnMoveRight" value="Right" class="btn btn-default" />
                    <input type="button" id="btnMoveLeft" value="Left" class="btn btn-default" />
                </div>
            </div>
        </div>
    </div>

    </div>

    <!--Add script to update the page and send messages.-->
    <script type="text/javascript">

        function getCard(parameters) {
            console.log('cardId: ' + $(parameters).data('cardId'));
            $('#title').val($('h4', parameters).text());
            $('#description').val($('p', parameters).text());
            $('#cardId').val($(parameters).data('cardId'));
        }


        $(function () {
            // Declare a proxy to reference the hub.
            var board = $.connection.boardHub;
            // Create a function that the hub can call to broadcast messages.
            board.client.boardMessage = function (message) {
                // Html encode display name and message.
                console.log('boardMessage');
                $.each(message, function (index, list) {
                    //console.log(list);
                    //console.log(index);

                    $.each(list.Cards, function (index, card) {
                        //console.log(card);
                        //console.log(index);
                        var template = $("<a onclick='getCard(this)' href='#form' class='list-group-item'><h4 class='list-group-item-heading'>Lorem ipsum</h4><p class='list-group-item-text'>Dolor sit amet</p></a>");
                        $('h4', template).text(card.Title + ' - ' + card.Position);
                        $('p', template).text(card.Description);
                        $(template).data('cardId', card.Id);
                        $(template).attr('id', card.Id);
                        //var cardId = '#' + cardId;
                        $('#' + card.Id).remove();
                        var id = "#" + card.ListId;
                        $(id).append(template);
                    });
                });
            };

            board.client.addCardMessage = function (card) {
                // Html encode display name and message.
                console.log('addCardMessage');

                var template = $("<a onclick='getCard(this)' href='#form' class='list-group-item'><h4 class='list-group-item-heading'>Lorem ipsum</h4><p class='list-group-item-text'>Dolor sit amet</p></a>");
                $('h4', template).text(card.Title);
                $('p', template).text(card.Description);
                $(template).data('cardId', card.Id);
                $(template).attr('id', card.Id);
                // Add the message to the first column.
                var id = "#" + card.ListId;
                $(id).append(template);
            };

            board.client.updateCardMessage = function (card) {
                // Html encode display name and message.
                console.log('updateCardMessage');
                var id = '#' + card.Id;
                var template = $(id);
                $('h4', template).text(card.Title);
                $('p', template).text(card.Description);
                $(template).data('cardId', card.Id);
            };

            board.client.deleteCardMessage = function (cardId) {
                console.log('deleteCardMessage');
                var id = '#' + cardId;
                $(id).remove();
            };

            // Start the connection.
            $.connection.hub.start().done(function () {
                console.log('$.connection.hub.start');
                board.server.Init("boardId"); // ignored

                $('#btnSave').click(function () {
                    // Call the Send method on the hub.
                    board.server.Add($('#title').val(), $('#description').val(), 'fb9344df-0d30-4183-bd15-d3c2e4afe978');
                    // Clear text box and reset focus for next comment.
                    $('#title').val('').focus();
                    $('#description').val('');
                });

                $('#btnUpdate').click(function () {
                    // Call the Update method on the hub.
                    board.server.Update($('#title').val(), $('#description').val(), $('#cardId').val());
                });

                $('#btnDelete').click(function () {
                    // Call the Update method on the hub.
                    board.server.Delete($('#cardId').val());
                });

                $('#btnMoveUp').click(function () {
                    // Call the Update method on the hub.
                    board.server.Move($('#cardId').val(), "Up");
                });
            });
        });
    </script>
</body>
</html>